openapi: 3.0.0
info:
  title: Expense Tracker API
  description: API for managing budgets, categories, and expenses.
  version: 1.0.0
servers:
  - url: http://localhost:8080/api
    description: Local development server

paths:
  /budgets:
    get:
      summary: Get all budgets
      responses:
        "200":
          description: A list of budgets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Budget"
    post:
      summary: Create or update a budget
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Budget"
      responses:
        "201":
          description: Budget created or updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Budget"

  /budgets/{month}/{year}:
    get:
      summary: Get budget by month and year
      parameters:
        - name: month
          in: path
          required: true
          schema:
            type: integer
        - name: year
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Budget details with status
          content:
            application/json:
              schema:
                type: object
                properties:
                  budget:
                    $ref: "#/components/schemas/Budget"
                  spent_amount:
                    type: number
                  remaining:
                    type: number
                  status:
                    type: string
                    enum: [within_budget, exceeded]

  /budgets/{id}:
    delete:
      summary: Delete a budget
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Budget deleted

  /categories:
    get:
      summary: Get all categories
      responses:
        "200":
          description: A list of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Category"
    post:
      summary: Create a new category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Category"
      responses:
        "201":
          description: Category created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Category"
        "400":
          description: Bad request

  /categories/{id}:
    put:
      summary: Update a category
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Category"
      responses:
        "200":
          description: Category updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Category"
    delete:
      summary: Delete a category
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Category deleted

  /expenses:
    get:
      summary: Get all expenses
      parameters:
        - name: category_id
          in: query
          schema:
            type: integer
        - name: payment_mode
          in: query
          schema:
            type: string
            enum: [UPI, Cash]
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        "200":
          description: A list of expenses
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Expense"
    post:
      summary: Create a new expense
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Expense"
      responses:
        "201":
          description: Expense created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Expense"
        "400":
          description: Bad request

  /expenses/{id}:
    get:
      summary: Get a single expense
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: Expense details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Expense"
    put:
      summary: Update an expense
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Expense"
      responses:
        "200":
          description: Expense updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Expense"
    delete:
      summary: Delete an expense
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        "204":
          description: Expense deleted

components:
  schemas:
    Budget:
      type: object
      properties:
        id:
          type: integer
        month:
          type: integer
        year:
          type: integer
        budget_amount:
          type: number
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - month
        - year
        - budget_amount

    Category:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
      required:
        - name

    Expense:
      type: object
      properties:
        id:
          type: integer
        category_id:
          type: integer
        amount:
          type: number
        description:
          type: string
        payment_mode:
          type: string
          enum: [UPI, Cash]
        expense_date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
      required:
        - category_id
        - amount
        - payment_mode
